;******************************************************************
;文件名称: kernel.asm
;编译方法:
;         nasm -f elf -o kernel.o kernel.asm
;         nasm -f elf -o string.o string.asm
;         nasm -f elf -o kliba.o kliba.asm
;         gcc -c -fno-builtin -o start.o start.c
;         ld -s -Ttext 0x30400 -o kernel.bin kernel.o string.o kliba.o start.o
;编译说明：内核映像。
;建立时间: 2011-11-13
;******************************************************************

SELECTOR_KERNEL_CS equ 8

;//////////////////////////////////////////////////////////////////
;导入函数
;//////////////////////////////////////////////////////////////////
extern cstart

;/////////////////////////////////////////////////////////////////

;/////////////////////////////////////////////////////////////////
;导出函数
;////////////////////////////////////////////////////////////////
global _start

;///////////////////////////////////////////////////////////////

;/////////////////////////////////////////////////////////////////
;导入全局变量
;/////////////////////////////////////////////////////////////////
extern gdt_ptr

;/////////////////////////////////////////////////////////////////

;///////////////////////////////////////////////////////////////
;变量区
;/////////////////////////////////////////////////////////////////
[SECTION .bss]
StackSpace    resb 2*1024
StackTop:                          ;栈顶
;////////////////////////////////////////////////////////////////

;////////////////////////////////////////////////////////////////
;代码段
;///////////////////////////////////////////////////////////////
[section .text]
global _start

_start:
    mov esp,StackTop
    sgdt [gdt_ptr]
    call cstart
    lgdt [gdt_ptr]

    jmp SELECTOR_KERNEL_CS:csinit

    csinit:
    push 0
    popfd

    hlt


;////////////////////////////////////////////////////////////////
